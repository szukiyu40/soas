<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>もし、あなたが分からないことが分かれば問題は半分は解けたようなもの！</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="navbar">
        <a href="#" id="languageToggle" onclick="toggleLanguage()">Switch to English</a>
    </div>
    <div class="container" style="margin-top: 60px;">
        <img src="./static/images/seekunknown.png" alt="Seek the Unknown Logo" class="logo" style="max-width: 00px; margin: 20px auto; display: block;">
        <h1 id="mainTitle">Seek the Unknown</h1>
        <h2 id="pageTitle">もし、あなたが分からないことが分かれば問題は半分は解けたようなもの！</h2>
        <p id="subTitle">あなたが気になっていることを質問してね。AIが回答するよ。</p>
        <textarea id="userInput" placeholder="メッセージを入力してください..." style="width: 80%; height: 100px; font-size: 16px;"></textarea>
        <button type="button" onclick="sendMessage()" id="sendButton">送信</button>
        <p id="botResponse">返答はここに表示されます...</p>
        <h2>Recent Questions and Answers</h2>
        <div id="recentQA"></div>
    </div>
    <script>
        let language = 'Japanese';  // 初期言語設定

        function toggleLanguage() {
            if (language === 'Japanese') {
                language = 'English';
                document.getElementById('languageToggle').innerText = 'Switch to Japanese';
                document.getElementById('pageTitle').innerText = 'If you know you don\'t know, the problem is half solved!';
                document.getElementById('subTitle').innerText = 'Ask anything that you are curious about. AI will answer.';
                document.getElementById('userInput').placeholder = 'Enter your message...';
                document.getElementById('sendButton').innerText = 'Send';
                document.getElementById('botResponse').innerText = 'Response will be shown here...';
                document.getElementById('searchPrompt').innerText = 'Search everyone\'s questions!';
                document.getElementById('searchInput').placeholder = 'Search messages...';
                document.getElementById('searchButton').innerText = 'Search';
                document.getElementById('searchResults').innerText = 'Search results will be shown here...';
                fetchRecentQA();
            } else {
                language = 'Japanese';
                document.getElementById('languageToggle').innerText = 'Switch to English';
                document.getElementById('pageTitle').innerText = 'もし、あなたが分からないことが分かれば問題は半分は解けたようなもの！';
                document.getElementById('subTitle').innerText = 'あなたが気になっていることを質問してね。AIが回答するよ。';
                document.getElementById('userInput').placeholder = 'メッセージを入力してください...';
                document.getElementById('sendButton').innerText = '送信';
                document.getElementById('botResponse').innerText = '返答はここに表示されます...';
                document.getElementById('searchPrompt').innerText = 'みんなの質問を検索してみよう！';
                document.getElementById('searchInput').placeholder = 'メッセージを検索...';
                document.getElementById('searchButton').innerText = '検索';
                document.getElementById('searchResults').innerText = '検索結果はここに表示されます...';
                fetchRecentQA();
            }
        }


        function sendMessage() {
            var userInput = document.getElementById('userInput').value;
            fetch('https://seekunknown.com/submit', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ message: userInput })
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('botResponse').innerText = 'Submit Response: ' + data.response;
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('botResponse').innerText = 'Error: Please try again later.';
            });
        }

        function searchMessage() {
            var searchQuery = document.getElementById('searchInput').value;
            fetch(`https://seekunknown.com/search?query=${encodeURIComponent(searchQuery)}`, {
                method: 'GET'
            })
            .then(response => response.json())
            .then(data => {
                if (data.length > 0) {
                    document.getElementById('searchResults').innerHTML = data.map(item => `${item.id}: ${item.message}`).join('<br>');
                } else {
                    document.getElementById('searchResults').innerText = 'No results found.';
                }
            })
            .catch(error => {
                console.error('Search Error:', error);
                document.getElementById('searchResults').innerText = 'Search failed. Try again later.';
            });
        }

        function fetchRecentQA() {
            // 仮のAPIエンドポイント '/api/recent-qa'
            fetch('/api/recent-qa')
            .then(response => response.json())
            .then(data => {
                let content = data.map(qa => 
                    `<div><strong>Question:</strong> ${qa.question}<br><strong>Answer:</strong> ${qa.answer}</div>`
                ).join('<hr>');
                document.getElementById('recentQA').innerHTML = content;
            })
            .catch(error => console.error('Error fetching recent QA:', error));
        }

        // 起動時に最近のQAを読み込む
        window.onload = fetchRecentQA;
    </script>
</body>
</html>